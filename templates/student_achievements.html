<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Student Achievements</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

  <style>
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    .achievement-container {
      max-width: 1000px;
      width: 100%;
      margin-top: 60px;
    }

    .filter-box {
      display: flex;
      gap: 10px;
      margin-bottom: 25px;
    }

    .filter-box select,
    .filter-box input {
      padding: 8px;
    }

    .achievement-card {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
    }

    .achievement-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .achievement-type {
      background: #007bff;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 13px;
    }

    .achievement-actions {
      margin-top: 10px;
      display: flex;
      gap: 10px;
    }

    .action-button {
      padding: 6px 10px;
      border-radius: 4px;
      text-decoration: none;
      font-size: 14px;
      border: 1px solid #333;
    }

    .download-btn {
      background: #28a745;
      color: white;
      border: none;
    }

    .view-btn {
      background: #f1f1f1;
    }
  </style>
</head>

<body>

<div class="achievement-container">

  <h2>My Achievements</h2>

  <!-- ================= FILTER SECTION ================= -->
  <div class="filter-box">
    <select id="type">
      <option value="">All Types</option>
      <option value="Academic">Academic</option>
      <option value="Sports">Sports</option>
      <option value="Technical">Technical</option>
    </select>

    <input type="number" id="year" placeholder="Year (e.g. 2024)">

    <input type="text" id="student_name" placeholder="Student name">

    <button onclick="applyFilter()">Filter</button>
  </div>

  <!-- ================= ACHIEVEMENTS LIST ================= -->
  <div id="achievement-list" class="achievement-list">

    {% for a in achievements %}
      <div class="achievement-card">
        <div class="achievement-header">
          <span class="achievement-type">{{ a.category }}</span>
          <span>{{ a.achievement_date }}</span>
        </div>

        <h4>{{ a.title }}</h4>
        <p><strong>Position:</strong> {{ a.position }}</p>
        <p>{{ a.description }}</p>

        <div class="achievement-actions">
          {% if a.certificate_path %}
            <a class="action-button download-btn"
               href="{{ url_for('static', filename=a.certificate_path) }}"
               download>
              Download Certificate
            </a>
          {% endif %}

          <a class="action-button view-btn"
             href="{{ url_for('edit_achievement', achievement_id=a.id) }}">
            Edit
          </a>
        </div>
      </div>
    {% endfor %}

  </div>

  <br>
  <a href="{{ url_for('student_dashboard') }}">‚Üê Back to Dashboard</a>

</div>

<!-- ================= JAVASCRIPT FILTER ================= -->
<script>
function applyFilter() {
  const type = document.getElementById("type").value;
  const year = document.getElementById("year").value;
  const student = document.getElementById("student_name").value;

  fetch(`/api/achievements/filter?type=${type}&year=${year}&student_name=${student}`)
    .then(res => res.json())
    .then(data => {
      const list = document.getElementById("achievement-list");
      list.innerHTML = "";

      if (data.length === 0) {
        list.innerHTML = "<p>No achievements found.</p>";
        return;
      }

      data.forEach(a => {
        list.innerHTML += `
          <div class="achievement-card">
            <div class="achievement-header">
              <span class="achievement-type">${a.category}</span>
              <span>${a.achievement_date}</span>
            </div>
            <h4>${a.title}</h4>
            <p><strong>Student:</strong> ${a.student_name}</p>
            <p><strong>Position:</strong> ${a.position}</p>
          </div>
        `;
      });
    });
}
</script>
<script>
function applyFilter() {
  const type = document.getElementById("type").value;
  const year = document.getElementById("year").value;
  const student = document.getElementById("student_name").value;

  const url = `/api/achievements/filter?type=${type}&year=${year}&student_name=${student}`;

  fetch(url)
    .then(res => res.json())
    .then(data => {
      const container = document.getElementById("achievement-list");
      container.innerHTML = "";

      if (data.length === 0) {
        container.innerHTML = "<p>No achievements found</p>";
        return;
      }

      data.forEach(a => {
        container.innerHTML += `
          <div class="card">
            <h4>${a.title}</h4>
            <p>Type: ${a.category}</p>
            <p>Student: ${a.student_name}</p>
            <p>Position: ${a.position}</p>
          </div>
        `;
      });
    });
}
</script>

</body>
</html>